<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>XTL: TMP Techniques</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_tiny.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">XTL
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">eXtended Template Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md__src_github_xtl_docs__t_m_p-_techniques.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">TMP Techniques </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>There are a few patterns in wide-spread employ across the TMP landscape and it's worth recognizing them. Here are a few of the more common patterns/idioms with examples.</p>
<h3>Use before declaration</h3>
<p>Template declarations are parsed at compile time and not instantiated until their use is defined in run-time code. If a template is not used in run-time code then it can contain a myriad of errors and the application will compile just fine since it's not used. This permits template to contain code that operates on template parameters before the concrete types are declared effectively decoupling two class declarations in ways that aren't possible in classic C++. For example, the following will not compile: </p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Cat{</div>
<div class="line">   Mouse m_Mouse;</div>
<div class="line">};</div>
<div class="line"><span class="keyword">struct </span>Mouse{</div>
<div class="line">  <span class="keywordtype">int</span> m_Cheese;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> Neither Cat nor Mouse are used in run-time code but it won't compile because Cat reference Mouse before it's declared and forward declarations won't help. However, consider the following: </p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> _MemberT&gt; <span class="keyword">struct </span>Cat{</div>
<div class="line">  _MemberT m_Mouse;</div>
<div class="line">};</div>
<div class="line"><span class="keyword">struct </span>Mouse{</div>
<div class="line">  <span class="keywordtype">int</span> m_Cheese;</div>
<div class="line">};</div>
<div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line">  Cat&lt;Mouse&gt; oCat;</div>
<div class="line">}</div>
</div><!-- fragment --><p> The templated version compiles just fine because the template isn't fully resolved until it's used in the run-time code in <code>main</code> (<code>Cat&lt;Mouse&gt; oCat</code>.) At this point the template becomes instantiated. All the types are fully defined at the time they're used in run-time code so everything works.</p>
<p>Expanding on this idiom, a template can interrogate the parameter: </p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> _MouseT&gt; <span class="keyword">struct </span>Cat{</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">bool</span> Catch(){</div>
<div class="line">    <span class="keywordflow">return</span> _MouseT::Slow;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"><span class="keyword">struct </span>MickeyMouse{</div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> Slow = <span class="keyword">true</span>;</div>
<div class="line">};</div>
<div class="line"><span class="keyword">struct </span>MightyMouse{</div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> Slow = <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Catch Mickey &quot;</span> &lt;&lt; std::boolalpha &lt;&lt; Cat&lt;MickeyMouse&gt;::Catch() &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Catch Mighty &quot;</span> &lt;&lt; std::boolalpha &lt;&lt; Cat&lt;MightyMouse&gt;::Catch() &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p> Here again <code>Cat</code> uses <code>_MouseT</code> but also uses a member named <code>Slow</code>. Using members of a template parameter like this requires that any type passed to the <code>Cat</code> template have a <code>Slow</code> member. In other words, the <code>_MouseT</code> parameter must adhere to a <em>concept</em> that <code>Cat</code> requires. As long as the type passed as <code>_MouseT</code> to the <code>Cat</code> template adheres to the <em>interface concept</em> the code is valid.</p>
<p>Performing similar feats in classic C++ normally requires a generic interface such as <code>IMouse</code> be declared with some pure virtual members that subclasses implement.</p>
<h3>Curiously Recurring Template Pattern</h3>
<p>This one looks odd at first glance and seems that it shouldn't compile. Here's a common use care with STL: </p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>MyStruct : std::enable_shared_from_this&lt;MyStruct&gt; ...</div>
</div><!-- fragment --><p> The MyStruct passes itself as a parameter to specialize std::enable_shared_from_this before the definition is complete. It doesn't look like it will compile but it does. This pattern is often used to give the base class visibility into the subclasses, something that cannot be easily done in classic OO.</p>
<h3>Parameterized Base Class</h3>
<p>This one also appears curious at first: </p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> _BaseT&gt; <span class="keyword">struct </span>MyStruct : _BaseT ...</div>
</div><!-- fragment --><p> MyStruct is a template that subclasses it's template parameter. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Aug 23 2016 06:51:09 for XTL by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
